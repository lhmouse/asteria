language: cpp

os: linux
dist: trusty
sudo: required

addons:
  apt:
    update: true
    packages:
      - checkinstall

matrix:
  include:
    env:
      - "_options=\"--enable-debug-logs\""
      - "_options=\"\""
    compiler:
      - gcc
      - clang

install:
  - "mkdir -p m4"
  - "autoreconf -ifv"
  - "test \"${CXX#*clang}\" == \"${CXX}\" || _options+=\" --disable-werror\""
  - "./configure CPPFLAGS=\"-D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC -D_DEBUG -D_LIBCPP_DEBUG\" --disable-silent-rules ${_options}"
  - "make -j$(nproc)"

script:
  - "./check_includes.sh"
  - "make -j$(nproc) check"

notifications:
  irc:
    channels:
      - "ircs://chat.freenode.net:6697/#mcfproj"
    template:
      - "[ lh_mouse %{repository_slug}#%{commit}] %{result} on %{branch} by %{author} (%{build_url})"
  email: false
